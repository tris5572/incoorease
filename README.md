# Incoorease

[Incoorease](https://tris5572.github.io/incoorease/)は、GPXファイルの座標を増やすWebアプリです。

自転車に乗る際にサイコン（サイクルコンピュータ）でナビをするとき、一部の機種では座標が間引かれて正確なルートをナビゲーションできないことがあります。そんな場合、このアプリで座標を増やしたGPXファイルを使えば、改善する可能性があります。

ただ現在の単純に座標を増やす動作だけでは改善しない機種もあるため、動作を追加予定です。

名前の由来は Increase (増やす) + Coordinate (座標) です。

# 使い方

1. **[Ride with GPS](https://ridewithgps.com/)** でルートを作り、**GPXファイル**(A)を書き出す。
2. [Incoorease ](https://tris5572.github.io/incoorease/)をWebブラウザで開く。
   1. GPXファイル(A)をドラッグ&ドロップして開く。
   2. 倍率を指定して座標追加を行う。（5倍くらいが目安）
   3. 座標が追加されたGPXファイル(B)をダウンロードする。
3. サイコンにGPXファイル(B)を転送し、ナビゲーションする。

## 制限事項

今はまだとりあえず作った程度の段階なので、現時点では以下のような制限があります。

- **Ride with GPS** で作成された**GPXファイル**のみ動作確認済み。
  - ファイル構造を決め打ちしたコードになっているため、汎用性が低い。
  - （ただ、手元で試した範囲では、他のアプリで書き出されたものも大丈夫だったので、意外とイケる可能性がある）
- 読み込めるファイルは1つのみ。
  - 複数ファイルをドロップしたとき、最後に読み込まれたファイルが反映される。

# モチベーション

自分のサイクリング体験を改善するために作成しました。

一部のサイコン、例えば [iGPSPORT iGS630](https://www.igpsport.jp/igs630) では、予め読み込ませた経路データを使用したナビゲーションを行うとき、「経路データが一定距離より長い場合は一定の割合で座標を間引く」ような処理を行っているようです。これは座標間隔が狭い経路データ（例えば実走によりサイコンで取得したデータ）ならばほぼ問題ありませんが、Ride with GPSで作成したような座標間隔が長いデータが間引かれると、曲がり角やカーブの経路が鈍ってしまい、道路ではないようなところを通る案内になり、まともなナビが行われなくなります。

「ふむ、間引かれるのなら、予め座標を増やしておけば良いのでは？」という考えで作成したのがこのアプリです。GPXファイルの座標の数が、指定した追加倍率になるよう、座標間に新たな座標を補完して挿入します。

## 補足

作者が使っている iGPSPORT iGS630 のファームウェアバージョンv1.43（2023年2月頃の最新版）では、約100kmの経路データに対して約9割程度の座標を間引く動作になっているように見えます。このとき、座標追加倍率を**5倍**くらいにしておけば、問題なくナビゲーションされます。

間引き動作が距離によって変わることもあり得るので、もっと長距離だとダメになるようなケースがあるかもしれません。また、ファームウェアのバージョンアップによりこうした対処が不要になる可能性もあります。

なお、追加している座標は近似値です。2点間の緯度経度の「度」を単純に等分しているだけなので、地球の丸みを考慮した値にはなっていません。ただ計算対象である2点間の距離は長くても数百m程度であると想定されるため、実用的には問題ありません。

# 採用技術

## フレームワーク：Svelte

アプリケーションフレームワークとして、Svelteを採用しています。単純なWebアプリなので、SvelteKitではなく素のSvelteを使用しています。

## 地図表示：Leaflet、地図タイル：国土地理院タイル

オープンに使える定番の組み合わせです。

## デプロイ：GitHub Pages

静的サイトなのでGitHub Pagesにホスティングしています。リポジトリにプッシュすれば自動的に更新された内容がデプロイされるようにGitHub Actionsを構築しています。
